{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<h1>üìä Store Dashboard</h1>

<style>
    .dashboard-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }
    
    .dashboard-card {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .dashboard-card h2 {
        margin-top: 0;
        color: #417690;
        font-size: 18px;
        border-bottom: 2px solid #417690;
        padding-bottom: 10px;
    }
    
    .stat-value {
        font-size: 32px;
        font-weight: bold;
        color: #2e7d32;
        margin: 10px 0;
    }
    
    .stat-label {
        color: #666;
        font-size: 14px;
    }
    
    .sub-stats {
        display: flex;
        justify-content: space-between;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #eee;
    }
    
    .sub-stat {
        text-align: center;
    }
    
    .sub-stat-value {
        font-size: 18px;
        font-weight: bold;
        color: #333;
    }
    
    .sub-stat-label {
        font-size: 12px;
        color: #666;
    }
    
    .product-list {
        list-style: none;
        padding: 0;
    }
    
    .product-list li {
        padding: 10px 0;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
    }
    
    .product-list li:last-child {
        border-bottom: none;
    }
    
    .order-list {
        list-style: none;
        padding: 0;
    }
    
    .order-list li {
        padding: 10px;
        margin: 5px 0;
        background: #f9f9f9;
        border-radius: 4px;
        border-left: 4px solid #417690;
    }
    
    .status-badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 12px;
        font-weight: bold;
    }
    
    .status-completed { background: #c8e6c9; color: #2e7d32; }
    .status-pending { background: #fff9c4; color: #f57f17; }
    .status-processing { background: #bbdefb; color: #1565c0; }
    .status-shipped { background: #b3e5fc; color: #0277bd; }
    .status-delivered { background: #c8e6c9; color: #2e7d32; }
    .status-cancelled { background: #ffcdd2; color: #c62828; }
    
    .alert-box {
        padding: 15px;
        border-radius: 4px;
        margin: 10px 0;
    }
    
    .alert-warning {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        color: #856404;
    }
    
    .alert-danger {
        background: #f8d7da;
        border-left: 4px solid #dc3545;
        color: #721c24;
    }
    
    .full-width {
        grid-column: 1 / -1;
    }
</style>

{% with data=dashboard_data %}
<div class="dashboard-container">
    
    <!-- Sales Overview Card -->
    <div class="dashboard-card">
        <h2>üí∞ Total Revenue</h2>
        <div class="stat-value">${{ data.sales_overview.total_revenue|floatformat:2 }}</div>
        <div class="stat-label">All-time revenue</div>
        <div class="sub-stats">
            <div class="sub-stat">
                <div class="sub-stat-value">${{ data.sales_overview.revenue_today|floatformat:2 }}</div>
                <div class="sub-stat-label">Today</div>
            </div>
            <div class="sub-stat">
                <div class="sub-stat-value">${{ data.sales_overview.revenue_this_week|floatformat:2 }}</div>
                <div class="sub-stat-label">This Week</div>
            </div>
            <div class="sub-stat">
                <div class="sub-stat-value">${{ data.sales_overview.revenue_this_month|floatformat:2 }}</div>
                <div class="sub-stat-label">This Month</div>
            </div>
        </div>
    </div>
    
    <!-- Orders Card -->
    <div class="dashboard-card">
        <h2>üì¶ Total Orders</h2>
        <div class="stat-value">{{ data.sales_overview.total_orders }}</div>
        <div class="stat-label">Completed orders</div>
        <div class="sub-stats">
            <div class="sub-stat">
                <div class="sub-stat-value">{{ data.sales_overview.orders_today }}</div>
                <div class="sub-stat-label">Today</div>
            </div>
            <div class="sub-stat">
                <div class="sub-stat-value">{{ data.sales_overview.orders_this_week }}</div>
                <div class="sub-stat-label">This Week</div>
            </div>
            <div class="sub-stat">
                <div class="sub-stat-value">{{ data.sales_overview.orders_this_month }}</div>
                <div class="sub-stat-label">This Month</div>
            </div>
        </div>
    </div>
    
    <!-- Average Order Value Card -->
    <div class="dashboard-card">
        <h2>üíµ Avg Order Value</h2>
        <div class="stat-value">${{ data.sales_overview.average_order_value|floatformat:2 }}</div>
        <div class="stat-label">Per completed order</div>
    </div>
    
    <!-- Customers Card -->
    <div class="dashboard-card">
        <h2>üë• Customers</h2>
        <div class="stat-value">{{ data.customer_statistics.total_customers }}</div>
        <div class="stat-label">Total registered</div>
        <div class="sub-stats">
            <div class="sub-stat">
                <div class="sub-stat-value">{{ data.customer_statistics.customers_with_orders }}</div>
                <div class="sub-stat-label">With Orders</div>
            </div>
            <div class="sub-stat">
                <div class="sub-stat-value">{{ data.customer_statistics.new_customers_this_month }}</div>
                <div class="sub-stat-label">New This Month</div>
            </div>
        </div>
    </div>
    
    <!-- Inventory Alerts -->
    {% if data.inventory_alerts.low_stock_count > 0 or data.inventory_alerts.out_of_stock_count > 0 %}
    <div class="dashboard-card full-width">
        <h2>‚ö†Ô∏è Inventory Alerts</h2>
        {% if data.inventory_alerts.out_of_stock_count > 0 %}
        <div class="alert-box alert-danger">
            <strong>üî¥ {{ data.inventory_alerts.out_of_stock_count }} product(s) out of stock!</strong>
            <a href="{% url 'admin:store_product_changelist' %}?stock__exact=0">View products</a>
        </div>
        {% endif %}
        {% if data.inventory_alerts.low_stock_count > 0 %}
        <div class="alert-box alert-warning">
            <strong>‚ö†Ô∏è {{ data.inventory_alerts.low_stock_count }} product(s) low on stock</strong>
            <a href="{% url 'admin:store_product_changelist' %}">View products</a>
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    <!-- Top Products Card -->
    <div class="dashboard-card">
        <h2>üèÜ Top Products</h2>
        <ul class="product-list">
            {% for product in data.top_products %}
            <li>
                <span>{{ product.product_name|truncatewords:3 }}</span>
                <strong>{{ product.total_sold }} sold</strong>
            </li>
            {% empty %}
            <li>No sales yet</li>
            {% endfor %}
        </ul>
    </div>
    
    <!-- Order Status Breakdown -->
    <div class="dashboard-card">
        <h2>üìä Order Status</h2>
        <ul class="product-list">
            {% for status, count in data.order_status_breakdown.items %}
            <li>
                <span style="text-transform: capitalize;">{{ status }}</span>
                <strong>{{ count }}</strong>
            </li>
            {% endfor %}
        </ul>
    </div>
    
    <!-- Reviews Card -->
    <div class="dashboard-card">
        <h2>‚≠ê Reviews</h2>
        <div class="stat-value">{{ data.review_statistics.average_rating }}</div>
        <div class="stat-label">Average rating</div>
        <div class="sub-stats">
            <div class="sub-stat">
                <div class="sub-stat-value">{{ data.review_statistics.approved_reviews }}</div>
                <div class="sub-stat-label">Approved</div>
            </div>
            <div class="sub-stat">
                <div class="sub-stat-value">{{ data.review_statistics.pending_reviews }}</div>
                <div class="sub-stat-label">Pending</div>
            </div>
        </div>
        {% if data.review_statistics.pending_reviews > 0 %}
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
            <a href="{% url 'admin:store_productreview_changelist' %}?is_approved__exact=0">
                Review pending ‚Üí
            </a>
        </div>
        {% endif %}
    </div>
    
    <!-- Recent Orders Card -->
    <div class="dashboard-card full-width">
        <h2>üïí Recent Orders</h2>
        <ul class="order-list">
            {% for order in data.recent_orders|slice:":5" %}
            <li>
                <div>
                    <strong>
                        <a href="{% url 'admin:store_order_change' order.id %}">
                            {{ order.order_number }}
                        </a>
                    </strong>
                    - {{ order.customer }} ({{ order.email }})
                </div>
                <div style="margin-top: 5px;">
                    <span class="status-badge status-{{ order.payment_status }}">
                        {{ order.payment_status|upper }}
                    </span>
                    <span class="status-badge status-{{ order.status }}">
                        {{ order.status|upper }}
                    </span>
                    <strong style="margin-left: 10px;">${{ order.total }}</strong>
                </div>
            </li>
            {% empty %}
            <li>No orders yet</li>
            {% endfor %}
        </ul>
        <div style="margin-top: 15px; text-align: center;">
            <a href="{% url 'admin:store_order_changelist' %}">View all orders ‚Üí</a>
        </div>
    </div>
    
</div>
{% endwith %}

{% endblock %}
